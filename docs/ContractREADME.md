# ğŸ± TON Cat Lottery - æ™ºèƒ½åˆç´„æ–‡æª”

> åŸºæ–¼ TON å€å¡Šéˆçš„è²“å’ª NFT æŠ½çç³»çµ±

---

## ğŸ“‹ ç›®éŒ„

- [ğŸ“ æª”æ¡ˆçµæ§‹](#-æª”æ¡ˆçµæ§‹)
- [ğŸ¯ é …ç›®æ¦‚è¦½](#-é …ç›®æ¦‚è¦½)
- [ğŸ”„ ç³»çµ±æ¶æ§‹èˆ‡æ¨¡çµ„æµç¨‹](#-ç³»çµ±æ¶æ§‹èˆ‡æ¨¡çµ„æµç¨‹)
- [ğŸš€ å¿«é€Ÿé–‹å§‹](#-å¿«é€Ÿé–‹å§‹)
- [ğŸŒ éƒ¨ç½²ï¼ˆæ¸¬è©¦ç¶²ï¼‰](#-éƒ¨ç½²æ¸¬è©¦ç¶²)
- [ğŸ› ï¸ æ•…éšœæ’é™¤](#ï¸-æ•…éšœæ’é™¤)
- [ğŸ“š åƒè€ƒè³‡æº](#-åƒè€ƒè³‡æº)


---
## ğŸ“ æª”æ¡ˆçµæ§‹

```
contracts/
â”œâ”€â”€ CatLottery.tact          # ä¸»æŠ½çåˆç´„
â”œâ”€â”€ CatNFT.tact             # è²“å’ª NFT åˆç´„
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deployCatLottery.ts  # æŠ½çåˆç´„éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ deployCatNFT.ts     # NFT åˆç´„éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ integrationTest.ts   # åˆç´„æ•´åˆæ¸¬è©¦è…³æœ¬
â”‚   â””â”€â”€ testNFTContract.ts   # NFT åˆç´„é‚è¼¯æ¸¬è©¦
â”œâ”€â”€ build/                  # ç·¨è­¯å¾Œçš„åˆç´„æª”æ¡ˆ
â””â”€â”€ tact.config.json        # Tact ç·¨è­¯é…ç½®
```

### ğŸ¯ **CatLottery.tact** - ä¸»è¦åŠŸèƒ½å‡½æ•¸

#### æ¥æ”¶å™¨ (Receivers)
- `receive("join")` - ç”¨æˆ¶åƒèˆ‡æŠ½ç
- `receive("drawWinner")` - åŸ·è¡ŒæŠ½çï¼ˆåƒ…æ“æœ‰è€…ï¼‰
- `receive("startNewRound")` - é–‹å§‹æ–°è¼ªæ¬¡ï¼ˆåƒ…æ“æœ‰è€…ï¼‰
- `receive("withdraw")` - æå–åˆç´„é¤˜é¡ï¼ˆåƒ…æ“æœ‰è€…ï¼‰
- `receive(msg: SetNFTContract)` - è¨­å®š NFT åˆç´„åœ°å€ï¼ˆåƒ…æ“æœ‰è€…ï¼‰

#### å…§éƒ¨å‡½æ•¸ (Internal Functions)
- `fun sendNFT(winner: Address, nftId: Int)` - è‡ªå‹•ç™¼é€ NFT çµ¦ä¸­çè€…
- `fun getCatNameByTemplate(templateId: Int): String` - æ ¹æ“šæ¨¡æ¿ ID ç²å–è²“å’ªåç¨±

#### æŸ¥è©¢å‡½æ•¸ (Getters)
- `get fun getContractInfo(): ContractInfo` - ç²å–åˆç´„åŸºæœ¬è³‡è¨Š
- `get fun getParticipant(index: Int): Participant?` - ç²å–åƒèˆ‡è€…è³‡è¨Š
- `get fun getWinner(round: Int): LotteryResult?` - ç²å–æŒ‡å®šè¼ªæ¬¡ä¸­çè¨˜éŒ„
- `get fun getBalance(): Int` - ç²å–åˆç´„é¤˜é¡

### ğŸ± **CatNFT.tact** - ä¸»è¦åŠŸèƒ½å‡½æ•¸

#### æ¥æ”¶å™¨ (Receivers)
- `receive(msg: MintTo)` - é‘„é€  NFTï¼ˆåƒ…æˆæ¬Šé‘„é€ è€…ï¼‰
- `receive(msg: NFTTransfer)` - NFT è½‰ç§»
- `receive(msg: SetAuthorizedMinter)` - è¨­å®šæˆæ¬Šé‘„é€ è€…ï¼ˆåƒ…æ“æœ‰è€…ï¼‰

#### å…§éƒ¨å‡½æ•¸ (Internal Functions)
- `fun initializeCatTemplates()` - åˆå§‹åŒ– 4 ç¨®è²“å’ªæ¨¡æ¿
- `fun determineRarity(tokenId: Int): Int` - åŸºæ–¼æ©Ÿç‡ç¢ºå®šç¨€æœ‰åº¦

#### æŸ¥è©¢å‡½æ•¸ (Getters)
- `get fun getNFT(tokenId: Int): NFTData?` - ç²å– NFT è©³ç´°è³‡æ–™
- `get fun balanceOf(owner: Address): Int` - ç²å–åœ°å€æ“æœ‰çš„ NFT æ•¸é‡
- `get fun getCatTemplate(templateId: Int): CatMetadata?` - ç²å–è²“å’ªæ¨¡æ¿
- `get fun getContractInfo(): NFTContractInfo` - ç²å– NFT åˆç´„è³‡è¨Š
- `get fun getAllCatTemplates(): map<Int, CatMetadata>` - ç²å–æ‰€æœ‰è²“å’ªæ¨¡æ¿



---

## ğŸ¯ é …ç›®æ¦‚è¦½

TON Cat Lottery åŒ…å«å…©å€‹ä¸»è¦æ™ºèƒ½åˆç´„ï¼š

### ğŸª æ ¸å¿ƒåˆç´„

1. **CatLottery.tact** - ä¸»æŠ½çåˆç´„ âœ…

   - âœ… **å®Œæ•´æŠ½çæµç¨‹ç®¡ç†** - ç”¨æˆ¶åƒèˆ‡ã€é©—è­‰æ¢ä»¶ã€è¨˜éŒ„åƒèˆ‡è€…
   - âœ… **æ™ºèƒ½éš¨æ©ŸæŠ½çæ©Ÿåˆ¶** - åŸºæ–¼æ™‚é–“æˆ³å’Œä¸Šä¸‹æ–‡è³‡è¨Šçš„å®‰å…¨éš¨æ©Ÿæ•¸
   - âœ… **è‡ªå‹• NFT ç™¼é€é‚è¼¯** - drawWinner å¾Œè‡ªå‹•èª¿ç”¨ sendNFT() 
   - âœ… **å®Œå–„ç‹€æ…‹ç®¡ç†** - lotteryActiveã€participantCountã€currentRound è‡ªå‹•ç®¡ç†
   - âœ… **äº‹ä»¶é©…å‹•ç³»çµ±** - ParticipantJoinedã€LotteryFullã€WinnerDrawnã€NFTSentã€NewRoundStarted
   - âœ… **è‡ªå‹•é‡ç½®æ©Ÿåˆ¶** - æŠ½çå®Œæˆå¾Œè‡ªå‹•æ¸…ç†ç‹€æ…‹ï¼Œç­‰å¾… startNewRound
   - âœ… **é‡è¤‡åƒèˆ‡é˜²è­·** - åŒä¸€åœ°å€ç„¡æ³•é‡è¤‡åƒèˆ‡åŒä¸€è¼ªæ¬¡
   - âœ… **æ“æœ‰è€…æ¬Šé™æ§åˆ¶** - drawWinnerã€startNewRoundã€withdraw åƒ…æ“æœ‰è€…å¯åŸ·è¡Œ

2. **CatNFT.tact** - è²“å’ª NFT åˆç´„ âœ…

   - âœ… **ç¬¦åˆ TON NFT è¦ç¯„** - å®Œæ•´çš„ NFT æ¨™æº–å¯¦ä½œ
   - âœ… **4 ç¨®ç¨€æœ‰åº¦è²“å’ª** - Common (60%), Rare (25%), Epic (10%), Legendary (5%)
   - âœ… **è±å¯Œ NFT Metadata** - name, description, rarity, attributes, image
   - âœ… **æˆæ¬Šé‘„é€ æ©Ÿåˆ¶** - åªæœ‰ CatLottery åˆç´„å¯é‘„é€  NFT
   - âœ… **å®Œæ•´æ‰€æœ‰æ¬Šç®¡ç†** - NFT è½‰ç§»ã€æ“æœ‰è€…è¨ˆæ•¸ã€ownership tracking
   - âœ… **è‡ªå‹•ç¨€æœ‰åº¦åˆ†é…** - åŸºæ–¼æ©Ÿç‡çš„æ™ºèƒ½ç¨€æœ‰åº¦ç¢ºå®šç³»çµ±

### ğŸ¨ NFT ç¨€æœ‰åº¦ç³»çµ±

| ç¨€æœ‰åº¦        | æ©Ÿç‡  | åç¨±             | æè¿°                   | å±¬æ€§                                    |
| ------------- | ----- | ---------------- | ---------------------- | --------------------------------------- |
| **Common**    | 60%   | Tabby            | å‹å–„çš„è™æ–‘è²“         | æ©™è‰²è™æ–‘æ¯›è‰²ã€ç¶ è‰²çœ¼ç›ã€å‹å–„æ€§æ ¼       |
| **Rare**      | 25%   | Siamese Princess | å„ªé›…çš„æš¹ç¾…è²“ï¼Œè—è‰²çœ¼ç› | æš¹ç¾…å¥¶æ²¹æ¯›è‰²ã€è—è‰²çœ¼ç›ã€å„ªé›…æ€§æ ¼       |
| **Epic**      | 10%   | Maine Coon King  | å¨åš´çš„ç·¬å› è²“ï¼Œç‹è€…é¢¨ç¯„ | ç·¬å› è²“æ£•è‰²æ¯›è‰²ã€ç¥ç€è‰²çœ¼ç›ã€å¨åš´æ€§æ ¼   |
| **Legendary** | 5%    | Cosmic Cat       | ç¥ç§˜çš„å®‡å®™è²“ï¼Œä¾†è‡ªæ˜Ÿç©º | å®‡å®™ç´«è‰²æ¯›è‰²ã€æ˜Ÿå…‰çœ¼ç›ã€ç¥ç§˜æ€§æ ¼       |

### ğŸ”§ **æŠ€è¡“ç‰¹è‰²**

#### **æ™ºèƒ½åˆç´„å®‰å…¨ç‰¹æ€§**
- âœ… **é‡å…¥æ”»æ“Šé˜²è­·** - æ­£ç¢ºçš„ç‹€æ…‹æ›´æ–°é †åºå’Œæª¢æŸ¥
- âœ… **æˆæ¬Šæ§åˆ¶** - åš´æ ¼çš„æ“æœ‰è€…å’Œæˆæ¬Šé‘„é€ è€…æ¬Šé™ç®¡ç†  
- âœ… **è¼¸å…¥é©—è­‰** - å®Œæ•´çš„ require èªå¥è¦†è“‹æ‰€æœ‰é‚Šç•Œæ¢ä»¶
- âœ… **é¤˜é¡æª¢æŸ¥** - åƒèˆ‡è²»ç”¨é©—è­‰å’Œåˆç´„é¤˜é¡ç®¡ç†

#### **é«˜å¯ç”¨æ€§è¨­è¨ˆ**
- âœ… **äº‹ä»¶å®Œæ•´æ€§** - æ‰€æœ‰é—œéµæ“ä½œéƒ½ç™¼å‡ºç›¸æ‡‰äº‹ä»¶
- âœ… **ç‹€æ…‹ä¸€è‡´æ€§** - è‡ªå‹•ç‹€æ…‹ç®¡ç†ç¢ºä¿åˆç´„ç‹€æ…‹å§‹çµ‚æ­£ç¢º
- âœ… **å¤±æ•—æ¢å¾©** - drawWinner å¤±æ•—ä¸å½±éŸ¿ä¸‹æ¬¡åŸ·è¡Œ
- âœ… **å¯è§€æ¸¬æ€§** - è±å¯Œçš„æŸ¥è©¢å‡½æ•¸æ”¯æ´ç‹€æ…‹æª¢æŸ¥

#### **Gas å„ªåŒ–**
- âœ… **é«˜æ•ˆéš¨æ©Ÿæ•¸ç”Ÿæˆ** - åŸºæ–¼éˆä¸Šè³‡è¨Šé¿å…å¤–éƒ¨ä¾è³´
- âœ… **æ‰¹é‡ç‹€æ…‹æ›´æ–°** - åœ¨å–®ä¸€äº¤æ˜“ä¸­å®Œæˆå¤šå€‹ç‹€æ…‹è®Šæ›´
- âœ… **é©ç•¶çš„ Gas è²»ç”¨é…ç½®** - ç‚º NFT é‘„é€ å’Œé€šçŸ¥é ç•™å……è¶³ Gas


---
## ğŸ”„ ç³»çµ±æ¶æ§‹èˆ‡æ¨¡çµ„æµç¨‹

### ğŸ“Š **æ•´é«”æ¶æ§‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å‰ç«¯     â”‚â—„â”€â”€â”€â”€â”€â”€ç›´æ¥é€šä¿¡â”€â”€â”€â”€â”€â”€â–ºâ”‚ TON å€å¡Šéˆ  â”‚
â”‚ (React)     â”‚   TON Connect SDK   â”‚  æ™ºèƒ½åˆç´„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â–²
                                           â”‚
                                    ç›£è½åˆç´„ç‹€æ…‹
                                           â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   å¾Œç«¯æœå‹™   â”‚
                                    â”‚ (Go Service) â”‚
                                    â”‚  å®ˆè­·é€²ç¨‹    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    è‡ªå‹•åŸ·è¡Œäº¤æ˜“
                                    (drawWinner/NFT)
```

**æ¶æ§‹èªªæ˜**ï¼š
- **å‰ç«¯ â†” æ™ºèƒ½åˆç´„**: ç”¨æˆ¶ç›´æ¥é€šé TON Connect èˆ‡åˆç´„äº’å‹•ï¼Œç„¡éœ€ç¶“éå¾Œç«¯
- **å¾Œç«¯å®ˆè­·é€²ç¨‹**: å®Œå…¨ç¨ç«‹é‹è¡Œï¼Œä¸æä¾›å°å¤– APIï¼Œå°ˆè·ç›£è½åˆç´„ç‹€æ…‹ä¸¦åŸ·è¡Œè‡ªå‹•åŒ–ä»»å‹™
- **å¾Œç«¯ â†’ æ™ºèƒ½åˆç´„**: å–®å‘æ“ä½œï¼Œåªè² è²¬ç™¼é€ drawWinner å’Œ startNewRound äº¤æ˜“
- **æ™ºèƒ½åˆç´„**: å…§å»º NFT è‡ªå‹•ç™¼é€é‚è¼¯ï¼Œç„¡éœ€å¾Œç«¯å¹²é 

### ğŸ¯ **æ ¸å¿ƒæ¨¡çµ„æµç¨‹**

#### **éšæ®µ 1: ç”¨æˆ¶åƒèˆ‡æŠ½ç**
```
ç”¨æˆ¶é»æ“Šåƒèˆ‡ â†’ TON Connect éŒ¢åŒ…é€£æ¥ â†’ ç™¼é€ 0.1 TON + "join" â†’ CatLottery åˆç´„
  â†“
åˆç´„é©—è­‰åƒèˆ‡æ¢ä»¶ â†’ è¨˜éŒ„åƒèˆ‡è€… â†’ æª¢æŸ¥äººæ•¸ â†’ è§¸ç™¼äº‹ä»¶
  â†“
- æœªæ»¿ 3 äºº: ç™¼é€ ParticipantJoined äº‹ä»¶
- é”åˆ° 3 äºº: ç™¼é€ LotteryFull äº‹ä»¶ + åœæ­¢æ¥å—æ–°åƒèˆ‡è€…
```

#### **éšæ®µ 2: æ™ºèƒ½ç›£è½ç³»çµ±** (æ··åˆç­–ç•¥)
```
ä¸¦è¡Œç›£è½æ¨¡å¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº‹ä»¶ç›£è½å™¨      â”‚  â”‚   è¼ªè©¢æª¢æŸ¥å™¨      â”‚
â”‚  (å³æ™‚éŸ¿æ‡‰)       â”‚ â”‚   (ä¿åº•æ©Ÿåˆ¶)       â”‚
â”‚                 â”‚  â”‚                  â”‚
â”‚ LotteryFulläº‹ä»¶  â”‚  â”‚  æ¯30ç§’æª¢æŸ¥åˆç´„    â”‚
â”‚   â†“ 1-5ç§’        â”‚  â”‚   â†“ æœ€å¤š30ç§’     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
        è‡ªå‹•è§¸ç™¼ drawWinner äº¤æ˜“
```

#### **éšæ®µ 3: è‡ªå‹•æŠ½çåŸ·è¡Œ**
```
è§¸ç™¼æ¢ä»¶æ»¿è¶³ â†’ å¾Œç«¯å‰µå»º drawWinner äº¤æ˜“ â†’ ç™¼é€è‡³ CatLottery åˆç´„
  â†“
åˆç´„åŸ·è¡ŒæŠ½çé‚è¼¯ â†’ é¸å‡ºä¸­çè€… â†’ ç”Ÿæˆ NFT ID
  â†“
åˆç´„è‡ªå‹•èª¿ç”¨ sendNFT() â†’ ç™¼é€ MintTo çµ¦ CatNFT åˆç´„ â†’ NFT é‘„é€ 
  â†“
ç™¼é€ WinnerDrawn äº‹ä»¶ (åŒ…å«: winner, nftId, round)
  â†“
ç™¼é€ NFTSent äº‹ä»¶ (åŒ…å«: recipient, nftId, nftContract)
```

#### **éšæ®µ 4: ç‹€æ…‹é‡ç½®** 
```
drawWinner åŸ·è¡Œå®Œæˆ â†’ åˆç´„è‡ªå‹•é‡ç½®ç‹€æ…‹:
  - lotteryActive = false (æš«åœæ¥å—æ–°åƒèˆ‡è€…)
  - participantCount = 0 (æ¸…ç©ºåƒèˆ‡è€…è¨ˆæ•¸)
  - æ¸…ç©º participants æ˜ å°„
  â†“
ç­‰å¾…å¾Œç«¯ç™¼é€ startNewRound ä¾†é‡æ–°å•Ÿå‹•
```

#### **éšæ®µ 5: æ–°è¼ªæ¬¡å•Ÿå‹•**
```
å¾Œç«¯ç›£è½åˆ° WinnerDrawn äº‹ä»¶ â†’ ç¢ºèªæŠ½çå®Œæˆ â†’ ç™¼é€ startNewRound äº¤æ˜“
  â†“
CatLottery åˆç´„åŸ·è¡Œæ–°è¼ªæ¬¡é‚è¼¯:
  - lotteryActive = true (é‡æ–°é–‹æ”¾åƒèˆ‡)
  - participantCount = 0 (å·²é‡ç½®) 
  - currentRound += 1 (è¼ªæ¬¡éå¢)
  - participants æ˜ å°„ (å·²æ¸…ç©º)
  â†“
ç³»çµ±æº–å‚™æ¥å—ä¸‹ä¸€è¼ªåƒèˆ‡è€…ï¼Œå®Œæˆè‡ªå‹•å¾ªç’°
```

### âš¡ **é—œéµæŠ€è¡“ç‰¹é»**

#### **1. é›™é‡ç›£è½ä¿éšœ**
- **ä¸»è¦**: äº‹ä»¶ç›£è½ (WebSocket) - éŸ¿æ‡‰é€Ÿåº¦ 1-5 ç§’
- **å‚™ç”¨**: å®šæ™‚è¼ªè©¢ - æ¯ 30 ç§’æª¢æŸ¥ï¼Œé˜²æ­¢äº‹ä»¶éºæ¼

#### **2. è‡ªå‹•åŒ–æµç¨‹**
- äººæ•¸é”æ¨™ â†’ åˆç´„è§¸ç™¼ LotteryFull äº‹ä»¶ â†’ å¾Œç«¯è‡ªå‹•åŸ·è¡Œ drawWinner
- æŠ½çåŸ·è¡Œ â†’ åˆç´„å…§å»ºè‡ªå‹•ç™¼é€ NFT (sendNFT) â†’ è§¸ç™¼ WinnerDrawn äº‹ä»¶
- äº‹ä»¶ç›£è½ â†’ å¾Œç«¯è‡ªå‹•åŸ·è¡Œ startNewRound â†’ é–‹å§‹æ–°è¼ªæ¬¡å¾ªç’°

#### **3. éŒ¯èª¤è™•ç†æ©Ÿåˆ¶**
- äº¤æ˜“å¤±æ•—è‡ªå‹•é‡è©¦ (æœ€å¤š 3 æ¬¡)
- ç¶²è·¯ç•°å¸¸æ™‚åˆ‡æ›åˆ°è¼ªè©¢æ¨¡å¼
- å®Œæ•´çš„æ—¥èªŒè¨˜éŒ„å’Œç›£æ§

#### **4. äº‹ä»¶é©…å‹•æ¶æ§‹**
```
åˆç´„äº‹ä»¶ â†’ å¾Œç«¯ç›£è½ â†’ è‡ªå‹•è™•ç† â†’ ç‹€æ…‹æ›´æ–° â†’ å‰ç«¯åˆ·æ–°
```

### ğŸ”„ **å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**
```
æ–°è¼ªæ¬¡é–‹å§‹ â†’ ç”¨æˆ¶åƒèˆ‡ â†’ é”åˆ°3äºº â†’ è‡ªå‹•æŠ½ç â†’ ç™¼é€NFT â†’ é‡ç½®è¼ªæ¬¡
     â†‘                                                         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è‡ªå‹•å¾ªç’° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---
### æ¸¬è©¦

#### `CatLottery.tact` çš„å–®å…ƒæ¸¬è©¦ âœ… (40å€‹æ¸¬è©¦æ¡ˆä¾‹)

**æ¸¬è©¦æ–‡ä»¶ï¼š** `tests/CatLottery.test.ts`  
**æ¸¬è©¦é€šéç‡ï¼š** 100% (40/40)  
**åŠŸèƒ½è¦†è“‹ç‡ï¼š** 100%

##### ğŸ“‹ æ¸¬è©¦åˆ†é¡æ˜ç´°

**1. åˆç´„åˆå§‹åŒ–æ¸¬è©¦ (1å€‹æ¸¬è©¦)**
- âœ… é©—è­‰åˆå§‹åŒ–åƒæ•¸æ­£ç¢ºæ€§ (owner, entryFee, maxParticipants, currentRound, lotteryActive, participantCount, nftContract)

**2. `join()` æ–¹æ³•æ¸¬è©¦ (7å€‹æ¸¬è©¦)**
- âœ… æ­£ç¢ºè²»ç”¨åƒèˆ‡æˆåŠŸ
- âœ… è²»ç”¨ä¸è¶³æ™‚æ‹’çµ•åƒèˆ‡
- âœ… åŒä¸€åœ°å€é‡è¤‡åƒèˆ‡æª¢æŸ¥
- âœ… å¤šå€‹ä¸åŒç”¨æˆ¶åƒèˆ‡
- âœ… é”åˆ°æœ€å¤§åƒèˆ‡äººæ•¸è‡ªå‹•åœç”¨æŠ½ç
- âœ… æŠ½çéæ´»èºç‹€æ…‹æ‹’çµ•åƒèˆ‡
- âœ… åƒèˆ‡è€…è³‡æ–™æ­£ç¢ºè¨˜éŒ„èˆ‡ç´¢å¼•

**3. `drawWinner()` æ–¹æ³•æ¸¬è©¦ (6å€‹æ¸¬è©¦)**
- âœ… åƒ…æ“æœ‰è€…å¯åŸ·è¡ŒæŠ½ç
- âœ… éæ“æœ‰è€…åŸ·è¡ŒæŠ½çè¢«æ‹’çµ•
- âœ… ä¸­çè€…é¸æ“‡å’Œçµæœè¨˜éŒ„
- âœ… æŠ½çå¾Œç‹€æ…‹é‡ç½® (lotteryActive=false, participantCount=0, æ¸…ç©ºåƒèˆ‡è€…åˆ—è¡¨)
- âœ… ç„¡åƒèˆ‡è€…æ™‚æŠ½çå¤±æ•—
- âœ… NFT ID ç”Ÿæˆé©—è­‰ (currentRound * 1000 + random)

**4. `sendNFT()` æ–¹æ³•æ¸¬è©¦ (4å€‹æ¸¬è©¦)**
- âœ… æŠ½çæ™‚æˆåŠŸç™¼é€ NFT åˆ° NFT åˆç´„
- âœ… NFT åˆç´„æœªè¨­å®šæ™‚å¤±æ•—
- âœ… å……è¶³ Gas è²»ç”¨çš„ NFT é‘„é€ 
- âœ… Gas ä¸è¶³æ™‚å„ªé›…è™•ç†

**5. `SetNFTContract` è¨Šæ¯æ¸¬è©¦ (3å€‹æ¸¬è©¦)**
- âœ… æ“æœ‰è€…è¨­å®š NFT åˆç´„åœ°å€æˆåŠŸ
- âœ… éæ“æœ‰è€…è¨­å®š NFT åˆç´„åœ°å€è¢«æ‹’çµ•
- âœ… æ“æœ‰è€…æ›´æ–° NFT åˆç´„åœ°å€

**6. `startNewRound()` æ–¹æ³•æ¸¬è©¦ (5å€‹æ¸¬è©¦)**
- âœ… æ“æœ‰è€…åœ¨æŠ½çéæ´»èºæ™‚é–‹å§‹æ–°è¼ªæ¬¡
- âœ… éæ“æœ‰è€…é–‹å§‹æ–°è¼ªæ¬¡è¢«æ‹’çµ•
- âœ… æŠ½çæ´»èºæ™‚é–‹å§‹æ–°è¼ªæ¬¡è¢«æ‹’çµ•
- âœ… é–‹å§‹æ–°è¼ªæ¬¡æ™‚æ¸…ç©ºåƒèˆ‡è€…åˆ—è¡¨
- âœ… æ–°è¼ªæ¬¡å¯æ¥å—æ–°åƒèˆ‡è€…

**7. `withdraw()` æ–¹æ³•æ¸¬è©¦ (5å€‹æ¸¬è©¦)**
- âœ… æ“æœ‰è€…åœ¨æŠ½çéæ´»èºæ™‚æå–é¤˜é¡
- âœ… éæ“æœ‰è€…æå–é¤˜é¡è¢«æ‹’çµ•
- âœ… æŠ½çæ´»èºæ™‚æå–é¤˜é¡è¢«æ‹’çµ•
- âœ… æå–å¾Œä¿æŒæœ€å°åˆç´„é¤˜é¡ (0.1 TON)
- âœ… åˆç´„é¤˜é¡ä¸è¶³æ™‚è™•ç†

**8. æŸ¥è©¢å‡½æ•¸æ¸¬è©¦ (7å€‹æ¸¬è©¦)**
- âœ… `getBalance()` - åˆç´„é¤˜é¡æŸ¥è©¢
- âœ… `getParticipant()` - åƒèˆ‡è€…è³‡è¨ŠæŸ¥è©¢ (å­˜åœ¨/ä¸å­˜åœ¨/é‚Šç•Œå€¼)
- âœ… `getWinner()` - ä¸­çè¨˜éŒ„æŸ¥è©¢ (å­˜åœ¨/ä¸å­˜åœ¨/å¤šè¼ªæ¬¡)
- âœ… `getContractInfo()` - åˆç´„ç‹€æ…‹ä¸€è‡´æ€§é©—è­‰
- âœ… å¤šè¼ªæ¬¡ä¸­çè¨˜éŒ„æ­£ç¢ºæ€§
- âœ… é›¶åƒèˆ‡è€…é‚Šç•Œæƒ…æ³
- âœ… é‚Šç•Œå€¼ç´¢å¼•è™•ç†

**9. è¼”åŠ©åŠŸèƒ½æ¸¬è©¦ (3å€‹æ¸¬è©¦)**
- âœ… `getCatNameByTemplate()` - ä¸åŒæ¨¡æ¿ ID çš„è²“å’ªåç¨± (é–“æ¥æ¸¬è©¦)
- âœ… åˆç´„åˆå§‹åŒ–åƒæ•¸é©—è­‰
- âœ… éš¨æ©Ÿæ•¸ç”Ÿæˆé‚Šç•Œæƒ…æ³è™•ç†

##### ğŸ”’ æ¸¬è©¦æ¶µè“‹çš„å®‰å…¨æ€§å’Œé‚Šç•Œæƒ…æ³
- æ¬Šé™æ§åˆ¶é©—è­‰ (åƒ…æ“æœ‰è€…æ“ä½œ)
- é‡è¤‡åƒèˆ‡é˜²è­·
- è²»ç”¨é©—è­‰å’ŒGasè™•ç†
- ç‹€æ…‹ä¸€è‡´æ€§æª¢æŸ¥
- é‚Šç•Œæ¢ä»¶è™•ç†
- ç•°å¸¸æƒ…æ³è™•ç†
- å¤šè¼ªæ¬¡ç‹€æ…‹ç®¡ç†

---

#### `CatNFT.tact` çš„å–®å…ƒæ¸¬è©¦ âœ… (19å€‹æ¸¬è©¦æ¡ˆä¾‹)

**æ¸¬è©¦æ–‡ä»¶ï¼š** `tests/CatNFT.test.ts`  
**æ¸¬è©¦é€šéç‡ï¼š** 100% (19/19)  
**åŠŸèƒ½è¦†è“‹ç‡ï¼š** ç´„85% (NFTTransferæœªå®Œå…¨å¯¦ç¾)

##### ğŸ“‹ æ¸¬è©¦åˆ†é¡æ˜ç´°

**1. åˆç´„åˆå§‹åŒ–æ¸¬è©¦ (4å€‹æ¸¬è©¦)**
- âœ… é©—è­‰åˆå§‹åŒ–åƒæ•¸æ­£ç¢ºæ€§ (owner, authorizedMinter, nextTokenId, totalSupply)
- âœ… 4ç¨®è²“å’ªæ¨¡æ¿åˆå§‹åŒ–é©—è­‰
  - Common: "Tabby" - å‹å–„çš„è™æ–‘è²“
  - Rare: "Siamese Princess" - å„ªé›…çš„æš¹ç¾…è²“
  - Epic: "Maine Coon King" - å¨åš´çš„ç·¬å› è²“
  - Legendary: "Cosmic Cat" - ç¥ç§˜çš„å®‡å®™è²“
- âœ… ä¸å­˜åœ¨æ¨¡æ¿çš„nullè¿”å›è™•ç†
- âœ… æ‰€æœ‰æ¨¡æ¿å±¬æ€§å®Œæ•´æ€§é©—è­‰ (name, rarity, description, attributes, image)

**2. `SetAuthorizedMinter` è¨Šæ¯æ¸¬è©¦ (3å€‹æ¸¬è©¦)**
- âœ… æ“æœ‰è€…è¨­å®šæˆæ¬Šé‘„é€ è€…æˆåŠŸ
- âœ… éæ“æœ‰è€…è¨­å®šæˆæ¬Šé‘„é€ è€…è¢«æ‹’çµ•
- âœ… æ“æœ‰è€…æ›´æ–°æˆæ¬Šé‘„é€ è€…åœ°å€

**3. `MintTo()` æ–¹æ³•æ¸¬è©¦ (6å€‹æ¸¬è©¦)**
- âœ… æˆæ¬Šé‘„é€ è€…æˆåŠŸé‘„é€  NFT
- âœ… é‘„é€ æˆæ¬Šé‚è¼¯è™•ç† (æ”¯æ´å¤šç¨®æˆæ¬Šæ¨¡å¼)
- âœ… æœªæˆæ¬Šåœ°å€é‘„é€  NFT è¢«æ‹’çµ•
- âœ… å¤šå€‹ NFT éå¢ç‹€æ…‹ç®¡ç† (nextTokenId, totalSupply)
- âœ… åŒä¸€æ“æœ‰è€…å¤šå€‹ NFT é¤˜é¡æ›´æ–°
- âœ… é‘„é€ æˆåŠŸå¾Œç™¼é€é€šçŸ¥çµ¦æ¥æ”¶è€…

**4. æŸ¥è©¢å‡½æ•¸æ¸¬è©¦ (4å€‹æ¸¬è©¦)**
- âœ… `balanceOf()` - åœ°å€ NFT é¤˜é¡æŸ¥è©¢ (é›¶é¤˜é¡/æœ‰é¤˜é¡)
- âœ… `getContractInfo()` - åˆç´„ç‹€æ…‹è³‡è¨Š (é‘„é€ å‰å¾Œç‹€æ…‹å°æ¯”)
- âœ… `getCatTemplate()` - è²“å’ªæ¨¡æ¿æŸ¥è©¢ (æ‰€æœ‰4ç¨®æ¨¡æ¿é©—è­‰)
- âœ… å¤šåœ°å€é¤˜é¡æŸ¥è©¢è™•ç†

**5. é‚Šç•Œæƒ…æ³å’ŒéŒ¯èª¤è™•ç† (3å€‹æ¸¬è©¦)**
- âœ… ä¸åŒæ“æœ‰è€…çš„åˆç´„åˆå§‹åŒ–
- âœ… å¤±æ•—æ“ä½œå¾Œç‹€æ…‹ä¸€è‡´æ€§ç¶­è­·
- âœ… Gas è²»ç”¨ä¸è¶³æ™‚çš„é©ç•¶è™•ç†

**6. `determineRarity()` ç¨€æœ‰åº¦ç³»çµ± (é–“æ¥é©—è­‰)**
- âœ… 4ç¨®ç¨€æœ‰åº¦æ¨¡æ¿æ­£ç¢ºæ˜ å°„
  - Common: 60% æ©Ÿç‡
  - Rare: 25% æ©Ÿç‡
  - Epic: 10% æ©Ÿç‡
  - Legendary: 5% æ©Ÿç‡
- âœ… æ¨¡æ¿ä¸€è‡´æ€§é©—è­‰ (templateId èˆ‡ rarity å°æ‡‰)

##### âš ï¸ æœªå®Œæˆçš„æ¸¬è©¦åŠŸèƒ½
**`NFTTransfer()` æ–¹æ³•æ¸¬è©¦** (å› æ•¸æ“šçµæ§‹å•é¡Œæš«æœªå¯¦ç¾)
- NFT æ“æœ‰è€…è½‰ç§»é©—è­‰
- éæ“æœ‰è€…è½‰ç§»æ‹’çµ•
- ä¸å­˜åœ¨ NFT è½‰ç§»æ‹’çµ•
- è½‰ç§»é€šçŸ¥å’Œå›æ‡‰è™•ç†

##### ğŸ—ï¸ NFT å…ƒæ•¸æ“šçµæ§‹
```typescript
struct CatMetadata {
    name: String;        // è²“å’ªåç¨±
    description: String; // æè¿°
    rarity: String;      // "Common", "Rare", "Epic", "Legendary"
    templateId: Int;     // 0: Common, 1: Rare, 2: Epic, 3: Legendary
    attributes: String;  // JSON æ ¼å¼çš„å±¬æ€§
    image: String;       // åœ–ç‰‡ URL
}
```

---

#### æ•´åˆæ¸¬è©¦ â³

**å¾…å¯¦ç¾çš„æ¸¬è©¦åŠŸèƒ½ï¼š**
- [ ] **åˆç´„é–“äº’å‹•æ¸¬è©¦**
  - CatLottery èˆ‡ CatNFT çš„æˆæ¬Šæ©Ÿåˆ¶æ¸¬è©¦
  - æŠ½çè§¸ç™¼ NFT é‘„é€ çš„å®Œæ•´æµç¨‹æ¸¬è©¦
  - è·¨åˆç´„äº‹ä»¶é©—è­‰
  - Gas è²»ç”¨åœ¨åˆç´„é–“è½‰ç§»çš„æ¸¬è©¦

##### ğŸƒ æ¸¬è©¦é‹è¡ŒæŒ‡å—

**å®‰è£ä¾è³´ï¼š**
```bash
npm install
```

**æ§‹å»ºåˆç´„ï¼š**
```bash
npm run build
```

**é‹è¡Œæ‰€æœ‰æ¸¬è©¦ï¼š**
```bash
npm test
```

**é‹è¡Œç‰¹å®šåˆç´„æ¸¬è©¦ï¼š**
```bash
# CatLottery æ¸¬è©¦
npm test -- --testNamePattern="CatLottery"

# CatNFT æ¸¬è©¦  
npm test -- --testNamePattern="CatNFT"
```

**æ¸¬è©¦è¦†è“‹ç‡å ±å‘Šï¼š**
```bash
npm run test:coverage
```

**ç›£è½æ¨¡å¼é‹è¡Œæ¸¬è©¦ï¼š**
```bash
npm run test:watch
```

##### ğŸ“Š æ¸¬è©¦ç¸½çµ

| åˆç´„ | æ¸¬è©¦æ¡ˆä¾‹ | é€šéç‡ | åŠŸèƒ½è¦†è“‹ç‡ | ç‹€æ…‹ |
|------|----------|--------|------------|------|
| CatLottery | 40 | 100% | 100% | âœ… |
| CatNFT | 19 | 100% | ~85% | âœ… |
| **ç¸½è¨ˆ** | **59** | **100%** | **~95%** | **âœ…** |

---
## ğŸš€ å¿«é€Ÿé–‹å§‹

### ğŸ“‹ å‰ç½®éœ€æ±‚
- Node.js >= 22
- TON Connect éŒ¢åŒ…ï¼ˆå¦‚ Tonkeeperï¼‰
- æ¸¬è©¦ç¶² TON ä»£å¹£

### âš¡ ç·¨è­¯åˆç´„
```bash
cd contracts
npm install
npm run build
```

### ğŸš€ éƒ¨ç½²åˆç´„

#### 1. éƒ¨ç½² NFT åˆç´„
```bash
npx blueprint run deployCatNFT --testnet
```

#### 2. éƒ¨ç½²æŠ½çåˆç´„  
```bash
npx blueprint run deployCatLottery --testnet
```

#### 3. è¨­å®šåˆç´„æˆæ¬Š
```bash
# è¨­å®š NFT åˆç´„çš„æˆæ¬Šé‘„é€ è€…ç‚ºæŠ½çåˆç´„
# è¨­å®šæŠ½çåˆç´„çš„ NFT åˆç´„åœ°å€

npx blueprint run integrationTest --testnet
```

---
## ğŸŒ éƒ¨ç½²ï¼ˆæ¸¬è©¦ç¶²ï¼‰

### ğŸ“ **å·²éƒ¨ç½²åˆç´„åœ°å€**

| åˆç´„é¡å‹        | åœ°å€                                                    | ç‹€æ…‹    |
| --------------- | ------------------------------------------------------ | ------- |
| **CatNFT**      | `kQAGSpk8Heq1xkTAL3q1DfxuSFGopYm6xXgNPN9Yexe0JTK7`   | âœ… å·²éƒ¨ç½² |
| **CatLottery**  | _å¾…éƒ¨ç½²_                                               | â³ å¾…éƒ¨ç½² |

### ğŸ”— **å€å¡Šéˆç€è¦½å™¨é€£çµ**
- [CatNFT åˆç´„è©³æƒ…](https://testnet.tonviewer.com/kQAGSpk8Heq1xkTAL3q1DfxuSFGopYm6xXgNPN9Yexe0JTK7)
- [TON Testnet Explorer](https://testnet.tonviewer.com/)

### âš™ï¸ **åˆç´„åƒæ•¸é…ç½®**
- **åƒèˆ‡è²»ç”¨**: 0.01 TON
- **æœ€å¤§åƒèˆ‡äººæ•¸**: 3 äºº  
- **ç¨€æœ‰åº¦æ©Ÿç‡**: Common (60%), Rare (25%), Epic (10%), Legendary (5%)

---
## ğŸ› ï¸ æ•…éšœæ’é™¤

### âŒ å¸¸è¦‹å•é¡Œ

#### **åˆç´„éƒ¨ç½²å¤±æ•—**
- ç¢ºèªéŒ¢åŒ…æœ‰è¶³å¤  TONï¼ˆè‡³å°‘ 0.3 TONï¼‰
- æª¢æŸ¥ç¶²è·¯é€£æ¥
- é‡è©¦éƒ¨ç½²æŒ‡ä»¤

#### **äº¤æ˜“è¢«æ‹’çµ•**
- æª¢æŸ¥åƒèˆ‡è²»ç”¨æ˜¯å¦è¶³å¤ ï¼ˆâ‰¥ 0.01 TONï¼‰
- ç¢ºèªæœªé‡è¤‡åƒèˆ‡åŒä¸€è¼ªæ¬¡
- æª¢æŸ¥æŠ½çæ˜¯å¦ä»æ´»èº

#### **NFT é‘„é€ å¤±æ•—**  
- ç¢ºèª CatLottery å·²è¨­å®šæ­£ç¢ºçš„ NFT åˆç´„åœ°å€
- ç¢ºèª CatNFT å·²è¨­å®š CatLottery ç‚ºæˆæ¬Šé‘„é€ è€…
- æª¢æŸ¥åˆç´„é¤˜é¡æ˜¯å¦è¶³å¤ æ”¯ä»˜ NFT é‘„é€  Gas

### ğŸ” **é™¤éŒ¯å·¥å…·**
- ä½¿ç”¨ `integrationTest.ts` é€²è¡Œå®Œæ•´æµç¨‹æ¸¬è©¦
- æª¢æŸ¥åˆç´„äº‹ä»¶æ—¥èªŒ
- ä½¿ç”¨ TON Explorer æŸ¥çœ‹äº¤æ˜“è©³æƒ…


---
## ğŸ“š åƒè€ƒè³‡æº

- [TON Blueprint](https://github.com/ton-org/blueprint)
- [TON Testnet Explorer](https://testnet.tonviewer.com/)
- [Tact èªè¨€æ–‡æª”](https://docs.tact-lang.org/)
- [TON Connect](https://docs.ton.org/develop/dapps/ton-connect/)