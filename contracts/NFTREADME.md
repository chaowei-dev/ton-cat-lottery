# ğŸ± TON Cat Lottery - æ™ºèƒ½åˆç´„æ–‡æª”

> åŸºæ–¼ TON å€å¡Šéˆçš„è²“å’ª NFT æŠ½çç³»çµ±æ™ºèƒ½åˆç´„å®Œæ•´æŒ‡å—

---

## ğŸ“‹ ç›®éŒ„

- [é …ç›®æ¦‚è¦½](#é …ç›®æ¦‚è¦½)
- [åˆç´„æ¶æ§‹](#åˆç´„æ¶æ§‹)
- [åŠŸèƒ½è©³ç´°èªªæ˜](#åŠŸèƒ½è©³ç´°èªªæ˜)
- [å®‰è£èˆ‡è¨­ç½®](#å®‰è£èˆ‡è¨­ç½®)
- [å‘½ä»¤åƒè€ƒ](#å‘½ä»¤åƒè€ƒ)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [æ¸¬è©¦æŒ‡å—](#æ¸¬è©¦æŒ‡å—)
- [API åƒè€ƒ](#api-åƒè€ƒ)
- [ä½¿ç”¨ç¯„ä¾‹](#ä½¿ç”¨ç¯„ä¾‹)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ğŸ¯ é …ç›®æ¦‚è¦½

TON Cat Lottery æ˜¯ä¸€å€‹å®Œæ•´çš„éˆä¸ŠæŠ½çç³»çµ±ï¼ŒåŒ…å«å…©å€‹ä¸»è¦åˆç´„ï¼š

### ğŸª æ ¸å¿ƒåˆç´„

1. **CatLottery.tact** - ä¸»æŠ½çåˆç´„

   - ç®¡ç†æŠ½çæµç¨‹
   - è™•ç†åƒèˆ‡è€…è¨»å†Š
   - åŸ·è¡Œéš¨æ©ŸæŠ½ç
   - è‡ªå‹•ç™¼é€ NFT çå‹µ

2. **CatNFT.tact** - è²“å’ª NFT åˆç´„
   - é‘„é€ ç¨ç‰¹çš„è²“å’ª NFT
   - 4 ç¨®ç¨€æœ‰åº¦ç­‰ç´š
   - å®Œæ•´çš„æ‰€æœ‰æ¬Šç®¡ç†
   - è½‰ç§»åŠŸèƒ½

### ğŸ¨ NFT ç¨€æœ‰åº¦ç³»çµ±

| ç¨€æœ‰åº¦        | åç¨±             | æè¿°                                |
| ------------- | ---------------- | ----------------------------------- |
| **Common**    | Orange Tabby     | å‹å–„çš„æ©˜è‰²è™æ–‘è²“ (Tabby)            |
| **Rare**      | Siamese Princess | å„ªé›…çš„æš¹ç¾…è²“ (Siamese)ï¼Œè—è‰²çœ¼ç›    |
| **Epic**      | Maine Coon King  | å¨åš´çš„ç·¬å› è²“ (Maine Coon)ï¼Œç‹è€…é¢¨ç¯„ |
| **Legendary** | Cosmic Cat       | ç¥ç§˜çš„å®‡å®™è²“ (Cosmic)ï¼Œä¾†è‡ªæ˜Ÿç©º     |

---

## ğŸ—ï¸ åˆç´„æ¶æ§‹

```
TON Cat Lottery ç³»çµ±
â”œâ”€â”€ CatLottery.tact          # ä¸»æŠ½çé‚è¼¯
â”‚   â”œâ”€â”€ åƒèˆ‡è€…ç®¡ç†
â”‚   â”œâ”€â”€ éš¨æ©ŸæŠ½çæ©Ÿåˆ¶
â”‚   â”œâ”€â”€ NFT ç™¼é€é›†æˆ
â”‚   â””â”€â”€ äº‹ä»¶æ—¥èªŒ
â”‚
â””â”€â”€ CatNFT.tact             # NFT ç®¡ç†
    â”œâ”€â”€ NFT é‘„é€ 
    â”œâ”€â”€ æ‰€æœ‰æ¬Šè½‰ç§»
    â”œâ”€â”€ è²“å’ªè³‡è¨ŠæŸ¥è©¢
    â””â”€â”€ åˆç´„ç®¡ç†
```

---

## ğŸ”§ åŠŸèƒ½è©³ç´°èªªæ˜

### CatLottery åˆç´„åŠŸèƒ½

#### ğŸ¯ æ ¸å¿ƒæŠ½çåŠŸèƒ½

- **åƒèˆ‡æŠ½ç** (`join`): æ”¯ä»˜ TON åƒèˆ‡ç•¶å‰è¼ªæ¬¡
- **åŸ·è¡ŒæŠ½ç** (`drawWinner`): éš¨æ©Ÿé¸å‡ºä¸­çè€…
- **è‡ªå‹• NFT ç™¼é€**: ä¸­çå¾Œè‡ªå‹•é‘„é€ ä¸¦ç™¼é€ NFT

#### ğŸ‘¥ åƒèˆ‡è€…ç®¡ç†

- **åƒèˆ‡è€…å„²å­˜**: è¨˜éŒ„æ‰€æœ‰åƒèˆ‡è€…åœ°å€å’Œé‡‘é¡
- **é‡è¤‡æª¢æŸ¥**: é˜²æ­¢åŒä¸€åœ°å€é‡è¤‡åƒèˆ‡
- **ä¸Šé™æ§åˆ¶**: é”åˆ°æœ€å¤§åƒèˆ‡äººæ•¸è‡ªå‹•é—œé–‰

#### ğŸ² éš¨æ©Ÿæ©Ÿåˆ¶

- **æ™‚é–“æˆ³éš¨æ©Ÿ**: åŸºæ–¼å€å¡Šæ™‚é–“æˆ³
- **Gas è²»ç”¨éš¨æ©Ÿ**: çµåˆäº¤æ˜“ Gas è²»ç”¨
- **åƒèˆ‡è€…æ•¸é‡**: åŠ å…¥åƒèˆ‡è€…æ•¸é‡ä½œç‚ºéš¨æ©Ÿå› å­

#### ğŸ† çå‹µç³»çµ±

- **NFT ID ç”Ÿæˆ**: åŸºæ–¼è¼ªæ¬¡å’Œéš¨æ©Ÿæ•¸
- **è²“å’ªé¡å‹é¸æ“‡**: éš¨æ©Ÿåˆ†é… 4 ç¨®è²“å’ªé¡å‹
- **è‡ªå‹•ç™¼é€**: ç›´æ¥é‘„é€ åˆ°ä¸­çè€…éŒ¢åŒ…

### CatNFT åˆç´„åŠŸèƒ½

#### ğŸ¨ NFT é‘„é€ 

- **åŸºç¤é‘„é€ ** (`mint`): é‘„é€  NFT çµ¦åˆç´„æ“æœ‰è€…
- **æŒ‡å®šé‘„é€ ** (`MintTo`): é‘„é€  NFT çµ¦æŒ‡å®šåœ°å€
- **è‡ªå‹• ID ç®¡ç†**: è‡ªå‹•åˆ†é…éå¢ NFT ID

#### ğŸ”„ NFT è½‰ç§»

- **å®‰å…¨è½‰ç§»** (`TransferNFT`): é©—è­‰æ“æœ‰è€…èº«ä»½
- **äº‹ä»¶æ—¥èªŒ**: è¨˜éŒ„æ‰€æœ‰è½‰ç§»æ“ä½œ
- **æ¬Šé™æª¢æŸ¥**: ç¢ºä¿åªæœ‰æ“æœ‰è€…å¯ä»¥è½‰ç§»

#### ğŸ“Š æŸ¥è©¢åŠŸèƒ½

- **æ“æœ‰è€…æŸ¥è©¢**: æŸ¥è©¢ç‰¹å®š NFT çš„æ“æœ‰è€…
- **å­˜åœ¨æ€§æª¢æŸ¥**: æª¢æŸ¥ NFT æ˜¯å¦å­˜åœ¨
- **è²“å’ªè³‡è¨Š**: ç²å–è²“å’ªçš„è©³ç´°è³‡è¨Š
- **åˆç´„ç‹€æ…‹**: æŸ¥è©¢ç¸½ä¾›æ‡‰é‡ç­‰ä¿¡æ¯

---

## ğŸš€ å®‰è£èˆ‡è¨­ç½®

### ç³»çµ±éœ€æ±‚

```bash
Node.js >= 18.0.0
npm >= 8.0.0
```

### å®‰è£æ­¥é©Ÿ

1. **å…‹éš†é …ç›®**

```bash
git clone <your-repo-url>
cd ton-cat-lottery/contracts
```

2. **å®‰è£ä¾è³´**

```bash
npm install
```

3. **é©—è­‰å®‰è£**

```bash
npm run build
```

---

## ğŸ“‹ å‘½ä»¤åƒè€ƒ

### ğŸ”¨ ç·¨è­¯å‘½ä»¤

```bash
# ç·¨è­¯æ‰€æœ‰åˆç´„
npm run build

# ç­‰åŒæ–¼
tact --config ./tact.config.json
```

**è¼¸å‡ºç”¢ç‰©ï¼š**

- `build/CatLottery_CatLottery.*` - æŠ½çåˆç´„ç·¨è­¯æ–‡ä»¶
- `build/CatNFT_CatNFT.*` - NFT åˆç´„ç·¨è­¯æ–‡ä»¶

### ğŸ§ª æ¸¬è©¦å‘½ä»¤

```bash
# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm test
# æˆ–
npm run test:all

# é‹è¡Œç‰¹å®šæ¸¬è©¦æ–‡ä»¶
npm test -- tests/CatLottery.test.ts

# ç›£è¦–æ¨¡å¼é‹è¡Œæ¸¬è©¦
npm run test:watch
```

### ğŸš€ éƒ¨ç½²å‘½ä»¤

#### éƒ¨ç½²åˆ°æ¸¬è©¦ç¶²

```bash
# éƒ¨ç½²æŠ½çåˆç´„
npm run deploy:testnet
# æˆ–
npx ts-node scripts/deploy.ts --network testnet

# éƒ¨ç½² NFT åˆç´„ (æ¨¡æ¿)
npx ts-node scripts/deploy-nft.ts
```

#### éƒ¨ç½²åˆ°ä¸»ç¶²

```bash
# éƒ¨ç½²æŠ½çåˆç´„
npm run deploy:mainnet
# æˆ–
npx ts-node scripts/deploy.ts --network mainnet
```

### ğŸ” é©—è­‰å‘½ä»¤

```bash
# é©—è­‰åˆç´„
npm run verify
# æˆ–
npx tsx scripts/verify.ts
```

### ğŸ® äº’å‹•å‘½ä»¤

```bash
# èˆ‡åˆç´„äº’å‹•
npx ts-node scripts/interact.ts
```

### ğŸ§¹ æ¸…ç†å‘½ä»¤

```bash
# æ¸…ç†ç·¨è­¯ç”¢ç‰©
rm -rf build/*

# é‡æ–°ç·¨è­¯
npm run build
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### æ­¥é©Ÿ 1: ç·¨è­¯åˆç´„

```bash
npm run build
```

### æ­¥é©Ÿ 2: éƒ¨ç½² NFT åˆç´„

```bash
npx ts-node scripts/deploy-nft.ts
```

**è¼¸å‡ºç¯„ä¾‹ï¼š**

```
ğŸš€ éƒ¨ç½² CatNFT åˆç´„...
ğŸ“¦ éƒ¨ç½²è€…åœ°å€: EQABC...
ğŸ“ åˆç´„åœ°å€: EQDEF...
ğŸ”— TON Explorer: https://testnet.tonviewer.com/EQDEF...
```

### æ­¥é©Ÿ 3: éƒ¨ç½²æŠ½çåˆç´„

```bash
npm run deploy:testnet
```

### æ­¥é©Ÿ 4: è¨­å®š NFT åˆç´„åœ°å€

ä½¿ç”¨ `SetNFTContract` æ¶ˆæ¯å°‡ NFT åˆç´„åœ°å€è¨­å®šåˆ°æŠ½çåˆç´„ä¸­ã€‚

### æ­¥é©Ÿ 5: é©—è­‰éƒ¨ç½²

1. åœ¨ TON Explorer ä¸­æª¢æŸ¥åˆç´„
2. é‹è¡Œæ¸¬è©¦ç¢ºèªåŠŸèƒ½æ­£å¸¸
3. å˜—è©¦åƒèˆ‡æ¸¬è©¦æŠ½ç

---

## ğŸ§ª æ¸¬è©¦æŒ‡å—

### é‹è¡Œæ¸¬è©¦å¥—ä»¶

```bash
# å®Œæ•´æ¸¬è©¦
npm test

# å…·é«”æ¸¬è©¦ç¯„ä¾‹
npm test -- --testNamePattern="should join lottery"
```

### æ¸¬è©¦æ¶µè“‹ç¯„åœ

#### CatLottery æ¸¬è©¦

- âœ… åˆç´„éƒ¨ç½²
- âœ… åƒèˆ‡æŠ½çåŠŸèƒ½
- âœ… æŠ½çæ©Ÿåˆ¶
- âœ… NFT ç™¼é€é›†æˆ
- âœ… æ¬Šé™æ§åˆ¶
- âœ… éŒ¯èª¤è™•ç†

#### CatNFT æ¸¬è©¦ (éœ€è¦å¯¦ç¾)

- âš ï¸ NFT é‘„é€ åŠŸèƒ½
- âš ï¸ è½‰ç§»æ©Ÿåˆ¶
- âš ï¸ æŸ¥è©¢åŠŸèƒ½
- âš ï¸ æ¬Šé™æ§åˆ¶

### æ‰‹å‹•æ¸¬è©¦

```bash
# 1. éƒ¨ç½²åˆç´„
npm run build
npx ts-node scripts/deploy-nft.ts

# 2. èˆ‡åˆç´„äº’å‹•
npx ts-node scripts/interact.ts

# 3. é©—è­‰åŠŸèƒ½
npx tsx scripts/verify.ts
```

---

## ğŸ“š API åƒè€ƒ

### CatLottery åˆç´„ API

#### æ¥æ”¶æ¶ˆæ¯

| æ¶ˆæ¯              | åƒæ•¸                   | æè¿°          | æ¬Šé™     |
| ----------------- | ---------------------- | ------------- | -------- |
| `"join"`          | -                      | åƒèˆ‡æŠ½ç      | ä»»ä½•äºº   |
| `"drawWinner"`    | -                      | åŸ·è¡ŒæŠ½ç      | åƒ…æ“æœ‰è€… |
| `"startNewRound"` | -                      | é–‹å§‹æ–°è¼ªæ¬¡    | åƒ…æ“æœ‰è€… |
| `"withdraw"`      | -                      | æå–é¤˜é¡      | åƒ…æ“æœ‰è€… |
| `SetNFTContract`  | `nftContract: Address` | è¨­å®š NFT åˆç´„ | åƒ…æ“æœ‰è€… |

#### æŸ¥è©¢æ–¹æ³•

| æ–¹æ³•                    | è¿”å›å€¼           | æè¿°           |
| ----------------------- | ---------------- | -------------- |
| `getContractInfo()`     | `ContractInfo`   | ç²å–åˆç´„ç‹€æ…‹   |
| `getParticipant(index)` | `Participant?`   | ç²å–åƒèˆ‡è€…è³‡è¨Š |
| `getWinner(round)`      | `LotteryResult?` | ç²å–ä¸­çè¨˜éŒ„   |
| `getBalance()`          | `Int`            | ç²å–åˆç´„é¤˜é¡   |

### CatNFT åˆç´„ API

#### æ¥æ”¶æ¶ˆæ¯

| æ¶ˆæ¯          | åƒæ•¸                            | æè¿°                | æ¬Šé™          |
| ------------- | ------------------------------- | ------------------- | ------------- |
| `"mint"`      | -                               | é‘„é€  NFT çµ¦è‡ªå·±     | åƒ…æ“æœ‰è€…      |
| `MintTo`      | `to: Address`                   | é‘„é€  NFT çµ¦æŒ‡å®šåœ°å€ | åƒ…æ“æœ‰è€…      |
| `TransferNFT` | `nftId: Int, newOwner: Address` | è½‰ç§» NFT            | åƒ… NFT æ“æœ‰è€… |
| `"withdraw"`  | -                               | æå–é¤˜é¡            | åƒ…æ“æœ‰è€…      |

#### æŸ¥è©¢æ–¹æ³•

| æ–¹æ³•                 | è¿”å›å€¼         | æè¿°              |
| -------------------- | -------------- | ----------------- |
| `getContractInfo()`  | `ContractInfo` | ç²å–åˆç´„è³‡è¨Š      |
| `getNftOwner(nftId)` | `Address?`     | ç²å– NFT æ“æœ‰è€…   |
| `nftExists(nftId)`   | `Bool`         | æª¢æŸ¥ NFT æ˜¯å¦å­˜åœ¨ |
| `getCatInfo(nftId)`  | `CatInfo`      | ç²å–è²“å’ªè³‡è¨Š      |

---

## ğŸ’¡ ä½¿ç”¨ç¯„ä¾‹

### å®Œæ•´æŠ½çæµç¨‹

```typescript
// 1. éƒ¨ç½²ä¸¦è¨­å®šåˆç´„
const lottery = await CatLottery.fromInit(owner, entryFee, maxParticipants);
const nft = await CatNFT.fromInit(owner);

// 2. è¨­å®š NFT åˆç´„åœ°å€
await lottery.send(owner, value, {
  $$type: 'SetNFTContract',
  nftContract: nft.address,
});

// 3. ç”¨æˆ¶åƒèˆ‡æŠ½ç
await lottery.send(user, { value: entryFee }, 'join');

// 4. åŸ·è¡ŒæŠ½ç
await lottery.send(owner, value, 'drawWinner');

// 5. æŸ¥è©¢ä¸­ççµæœ
const winner = await lottery.getWinner(1);
console.log(`ä¸­çè€…: ${winner.winner}`);
console.log(`NFT ID: ${winner.nftId}`);
```

### NFT æ“ä½œç¯„ä¾‹

```typescript
// é‘„é€  NFT
await nftContract.send(owner, value, {
  $$type: 'MintTo',
  to: recipientAddress,
});

// è½‰ç§» NFT
await nftContract.send(currentOwner, value, {
  $$type: 'TransferNFT',
  nftId: 1,
  newOwner: newOwnerAddress,
});

// æŸ¥è©¢è²“å’ªè³‡è¨Š
const catInfo = await nftContract.getCatInfo(1);
console.log(`è²“å’ª: ${catInfo.name} (${catInfo.rarity})`);
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. ç·¨è­¯éŒ¯èª¤

**å•é¡Œï¼š** `Cannot find module '@tact-lang/compiler'`

```bash
# è§£æ±ºæ–¹æ¡ˆ
npm install @tact-lang/compiler
```

#### 2. éƒ¨ç½²å¤±æ•—

**å•é¡Œï¼š** `Invalid address checksum`

```bash
# æª¢æŸ¥åœ°å€æ ¼å¼ï¼Œç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„ TON åœ°å€æ ¼å¼
# EQ... æˆ– UQ... é–‹é ­
```

#### 3. æ¸¬è©¦å¤±æ•—

**å•é¡Œï¼š** æ¸¬è©¦é‹è¡Œå¤±æ•—

```bash
# é‡æ–°ç·¨è­¯ä¸¦é‹è¡Œæ¸¬è©¦
npm run build
npm test
```

#### 4. NFT é‘„é€ å¤±æ•—

**å•é¡Œï¼š** `Only owner can mint`

```bash
# ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„æ“æœ‰è€…åœ°å€ç™¼é€äº¤æ˜“
```

### é™¤éŒ¯æŠ€å·§

1. **æª¢æŸ¥ç·¨è­¯è¼¸å‡º**

```bash
npm run build 2>&1 | tee build.log
```

2. **ä½¿ç”¨è©³ç´°æ—¥èªŒ**

```bash
npm test -- --verbose
```

3. **æª¢æŸ¥åˆç´„ç‹€æ…‹**

```bash
npx tsx scripts/verify.ts
```